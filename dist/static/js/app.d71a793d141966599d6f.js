webpackJsonp([1],{"++uL":function(t,e){},E8E6:function(t,e){},JJq9:function(t,e){},JXub:function(t,e){},JfLk:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("7+uW"),s=n("Xxa5"),i=n.n(s),a=n("exGp"),o=n.n(a),u={name:"GroupsForm",props:{},data:function(){return{name:"",members:[]}},computed:{users:function(){return this.$store.getters.getUsers},groups:function(){return this.$store.getters.getGroups}},methods:{addGroup:function(){var t=this;return o()(i.a.mark(function e(){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.members.map(function(t){n.push({id:t,debtors:{},balance:0})}),e.next=4,t.$store.dispatch("createGroup",{name:t.name,members:n});case 4:r=t.groups[t.groups.length-1].id,t.members.map(function(e){t.$store.dispatch("createConnection",{groupId:r,userId:e})}),t.$f7.views.main.router.back();case 7:case"end":return e.stop()}},e,t)}))()},toggleCheckbox:function(t){this.members.includes(t.id)?this.members.splice(this.members.findIndex(function(e){return e===t.id}),1):this.members.push(t.id)},isSelected:function(t){return this.members.includes(t.id)}}},c={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{"back-link":"Back",title:"Новая группа"}},[n("f7-nav-right",[n("f7-link",{on:{click:t.addGroup}},[t._v("Добавить")])],1)],1),t._v(" "),n("f7-list",{attrs:{"inline-labels":"","no-hairlines-md":""}},[n("f7-list-item",[n("f7-label",[t._v("Имя")]),t._v(" "),n("f7-input",{attrs:{value:t.name,type:"text",placeholder:"Имя группы","clear-button":""},on:{input:function(e){t.name=e.target.value}}})],1)],1),t._v(" "),n("f7-list",t._l(t.users,function(e){return n("f7-list-item",{key:e.id,attrs:{checkbox:"",title:e.name},on:{click:function(n){t.toggleCheckbox(e)}}},[n("img",{attrs:{slot:"media",src:e.picture},slot:"media"})])})),t._v(" "),n("f7-block-footer",[n("f7-link",{on:{click:function(e){t.$f7.views.main.router.navigate({url:"/adduser/"})}}},[t._v("Добавить пользователя")])],1)],1)},staticRenderFns:[]};var d=n("VU/8")(u,c,!1,function(t){n("JfLk")},"data-v-1f7ffcd1",null).exports,l={name:"UsersForm",props:{},data:function(){return{name:"",picture:""}},computed:{},created:function(){this.getPicture()},methods:{addUser:function(){var t=this;return o()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.createUser();case 2:case"end":return e.stop()}},e,t)}))()},getPicture:function(){var t=this;return o()(i.a.mark(function e(){var n,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.randomuser.me/?lego");case 2:return n=e.sent,e.next=5,n.json();case 5:r=e.sent,t.picture=r.results[0].picture.thumbnail;case 7:case"end":return e.stop()}},e,t)}))()},createUser:function(){this.$store.dispatch("createUser",{name:this.name,picture:this.picture}),this.$f7.views.main.router.back()}}},p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{"back-link":"Back",title:"Новый пользователь"}},[n("f7-nav-right",[n("f7-link",{on:{click:t.addUser}},[t._v("Добавить")])],1)],1),t._v(" "),n("f7-list",[n("f7-list-item",[n("img",{attrs:{slot:"media",src:t.picture},slot:"media"}),t._v(" "),n("f7-list",{staticClass:"user-form",attrs:{"simple-list":""}},[n("f7-list-item",[n("f7-input",{attrs:{placeholder:"Имя",value:t.name,type:"text","clear-button":""},on:{input:function(e){t.name=e.target.value}}})],1),t._v(" "),n("f7-list-item",[n("f7-input",{attrs:{placeholder:"Email",type:"email","clear-button":""}})],1)],1)],1)],1)],1)},staticRenderFns:[]};var f=n("VU/8")(l,p,!1,function(t){n("h09z")},"data-v-c0dd3636",null).exports,m=n("fZjL"),h=n.n(m),b={props:{},data:function(){return{}},computed:{members:function(){var t=0===h()(this.$f7router.currentRoute).length||0===h()(this.$f7router.currentRoute.params).length;return console.log("USERS CARD",t),t?this.$store.getters.getUsers:this.$store.getters.getGroupById(this.$f7router.currentRoute.params.id)[0].members}},methods:{picture:function(t){return this.$store.getters.getPictureByUserId(t)},name:function(t){return this.$store.getters.getNameByUserId(t)},openUserScreen:function(t){this.$f7router.navigate("/users/"+t)}}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-list",t._l(t.members,function(e){return n("f7-list-item",{key:e.id,attrs:{link:"#",title:t.name(e.id),after:e.balance},on:{click:function(n){t.openUserScreen(e.id)}}},[n("img",{attrs:{slot:"media",src:t.picture(e.id)},slot:"media"})])}))},staticRenderFns:[]};var g=n("VU/8")(b,v,!1,function(t){n("E8E6")},"data-v-678ad32a",null).exports,y={props:{groups:Array},data:function(){return{}},computed:{},methods:{members:function(t){return this.$store.getters.getMembersByGroupId(t)},balance:function(t){return this.$store.getters.getPaymentByGroupId(t).reduce(function(t,e){return t+e.sum},0)},openGroup:function(t){this.$f7.views.main.router.navigate({url:"/groups/"+t})}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-list",t._l(t.groups,function(e){return n("f7-list-item",{key:e.id,attrs:{link:"#",title:e.name,after:t.balance(e.id)},on:{click:function(n){t.openGroup(e.id)}}},t._l(t.members(e.id),function(t,e){return n("img",{key:e,attrs:{slot:"media",src:t.picture},slot:"media"})}))}))},staticRenderFns:[]};var B=n("VU/8")(y,_,!1,function(t){n("whbx")},"data-v-c0286f78",null).exports,$={props:{user:Object},data:function(){return{isVisible:!0}},methods:{onCancel:function(){this.$emit("onCancel")},onConfirm:function(){this.$emit("onConfirm")}}},I={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-alert-dialog",{attrs:{modifier:"rowfooter",visible:t.isVisible},on:{"update:visible":function(e){t.isVisible=e}}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v("Списать долг")]),t._v("\n  "+t._s(t.user.who.name)+" перед "+t._s(t.user.whom.name)+"?\n  "),n("template",{slot:"footer"},[n("v-ons-alert-dialog-button",{on:{click:t.onCancel}},[t._v("Нет")]),t._v(" "),n("v-ons-alert-dialog-button",{on:{click:t.onConfirm}},[t._v("Да")])],1)],2)},staticRenderFns:[]};var U={components:{ConfirmModal:n("VU/8")($,I,!1,function(t){n("JXub")},null,null).exports},props:{},data:function(){return{confirmModal:!1,isGroup:!1,debtUser:null}},watch:{},computed:{debtors:function(){return console.log("DEBTORS CARD"),0===h()(this.$f7router.currentRoute).length||0===h()(this.$f7router.currentRoute.params).length?(this.isGroup=!1,this.$store.getters.getDebtors):(this.isGroup=!0,this.$store.getters.getDebtorsByGroupId(this.$f7router.currentRoute.params.id))}},methods:{confirmSettleDebt:function(t){this.confirmModal=!0,this.debtUser=t},cancelSettleDebt:function(){this.confirmModal=!1,this.debtUser=null},settleDebt:function(t){var e=this,n=t.sum,r=t.who,s=t.whom;this.confirmModal=!1;var i=this.$store.getters.getUsers.find(function(t){return t.id===r.id}),a=this.$store.getters.getUsers.find(function(t){return t.id===s.id});console.log("settleDebt",n,r,s),i.balance-=n,i.debtors[s.id]=0,a.balance+=n,this.$store.dispatch("updateUser",{id:i.id,balance:i.balance,debtors:i.debtors}),this.$store.dispatch("updateUser",{id:a.id,balance:a.balance,debtors:a.debtors}),this.$store.getters.getGroups.map(function(t){var n=[],i=0;t.members.map(function(t){t.id===r.id&&(i=t.balance,t.balance=0,t.debtors[s.id]=0),t.id===s.id&&(t.balance+=i),n.push({id:t.id,debtors:t.debtors,balance:t.balance})}),e.$store.dispatch("updateGroup",{id:t.id,members:n})}),this.$store.dispatch("createPayment",{groupId:0,description:"Списан долг",sum:-1*n,paidBy:{userId:r.id,name:r.name},paidTo:[{userId:s.id,name:s.name}],transactions:[{userId:r.id,sum:-1*n},{userId:s.id,sum:n}]})},settleGroupDebt:function(t){var e=t.sum,n=t.who,r=t.whom;this.confirmModal=!1;var s=this.$store.getters.getUsers.find(function(t){return t.id===n.id}),i=this.$store.getters.getUsers.find(function(t){return t.id===r.id});console.log("settleGroupDebt",e,n,r),s.balance-=e,i.balance+=e,i.debtors[n.id]+=e,this.$store.dispatch("updateUser",{id:s.id,balance:s.balance,debtors:s.debtors}),this.$store.dispatch("updateUser",{id:i.id,balance:i.balance,debtors:i.debtors});var a=[],o=0;this.$store.getters.getGroupById(this.$f7router.currentRoute.params.id)[0].members.map(function(t){t.id===n.id&&(o=t.balance,t.balance=0,t.debtors[r.id]=0),t.id===r.id&&(t.balance+=o),a.push({id:t.id,debtors:t.debtors,balance:t.balance})}),this.$store.dispatch("updateGroup",{id:this.$f7router.currentRoute.params.id,members:a}),this.$store.dispatch("createPayment",{groupId:this.$f7router.currentRoute.params.id,description:"Списан долг",sum:-1*e,paidBy:{userId:n.id,name:n.name},paidTo:[{userId:r.id,name:r.name}],transactions:[{userId:n.id,sum:-1*e},{userId:r.id,sum:e}]})}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-list",{staticClass:"debtors-card"},t._l(t.debtors,function(e){return n("f7-list-item",{key:e.id},[n("div",{staticClass:"center"},[n("b",[t._v(t._s(e.who.name))]),t._v(" "),n("img",{attrs:{src:e.who.picture}}),t._v("\n      должен\n      "),n("b",[t._v(t._s(e.whom.name))]),t._v(" "),n("img",{attrs:{src:e.whom.picture}}),t._v(" "),n("span",{staticClass:"sum"},[t._v(": "+t._s(-Math.round10(e.sum,-2)))])]),t._v(" "),n("div",{staticClass:"right"},[n("f7-icon",{attrs:{ios:"ion:ios-arrow-dropup",md:"material:md-arrow-dropup"},on:{click:function(n){t.confirmSettleDebt(e)}}})],1),t._v(" "),t.confirmModal?n("confirm-modal",{attrs:{user:t.debtUser},on:{onCancel:t.cancelSettleDebt,onConfirm:function(e){t.isGroup?t.settleGroupDebt(t.debtUser):t.settleDebt(t.debtUser)}}}):t._e()],1)}))},staticRenderFns:[]};var P=n("VU/8")(U,k,!1,function(t){n("UK6u")},"data-v-662a2b66",null).exports,w={props:{payments:Array},data:function(){return{}},computed:{currentPayments:function(){return this.$f7router.currentRoute.params.id?this.$store.getters.getPaymentByGroupId(this.$f7router.currentRoute.params.id):this.payments}},methods:{subtitle:function(t){var e=t.paidTo.reduce(function(t,e){return t+e.name+", "},"").slice(0,-2);return t.paidBy.name+" заплатил за "+e},showPaymentModal:function(){this.$emit("showPaymentModal",!0)},paidToUsers:function(t,e,n){var r="";return r+=t.name}}},G={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-list",{attrs:{"media-list":""}},t._l(t.currentPayments,function(e){return n("f7-list-item",{key:e.id,attrs:{title:e.description,subtitle:t.subtitle(e),after:e.sum}})}))},staticRenderFns:[]};var S=n("VU/8")(w,G,!1,function(t){n("OBvC")},null,null).exports,x={components:{GroupsForm:d,UsersForm:f,UsersCard:g,GroupsCard:B,DebtorsCard:P,HistoryCard:S},props:{},data:function(){return{isUsersFormVisible:!1,isGroupsFormVisible:!1,owesUsers:[]}},computed:{users:function(){return this.$store.getters.getUsers},groups:function(){return this.$store.getters.getGroups}},methods:{}},E={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{title:"PieApp"}}),t._v(" "),n("f7-block-title",[t._v("\n    Группы\n  ")]),t._v(" "),n("groups-card",{attrs:{groups:t.groups}}),t._v(" "),n("f7-block-footer",[n("f7-link",{on:{click:function(e){t.$f7.views.main.router.navigate({url:"/addgroup/"})}}},[t._v("Добавить группу")])],1),t._v(" "),n("f7-block-title",[t._v("\n    Пользователи\n  ")]),t._v(" "),n("users-card",{attrs:{users:t.users}}),t._v(" "),n("f7-block-title",[n("div",{staticClass:"left"},[t._v("Должники")])]),t._v(" "),n("debtors-card",{attrs:{users:t.users}})],1)},staticRenderFns:[]};var C=n("VU/8")(x,E,!1,function(t){n("u2dc")},"data-v-92d5c4e4",null).exports,R={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-ons-list",[e("v-ons-list-item",[e("div",{staticClass:"left"}),this._v(" "),e("div",{staticClass:"center"},[this._v("\n      "+this._s(this.name)+"\n    ")])])],1)},staticRenderFns:[]};var M=n("VU/8")({props:{},data:function(){return{}},computed:{name:function(){return this.$f7router.currentRoute.params.id?this.$store.getters.getGroupById(this.$f7router.currentRoute.params.id)[0].name:""}}},R,!1,function(t){n("rcZV")},null,null).exports,F=n("mvHQ"),T=n.n(F),D={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{"back-link":"Back",title:"Кто платит"}}),t._v(" "),n("f7-list",t._l(t.users,function(e,r){return n("f7-list-item",{key:e.id,attrs:{radio:"",title:e.name,value:e.name,checked:t.paidBy===e.id},on:{change:function(n){t.commitPaidByToStore(e.id)}}},[n("img",{attrs:{slot:"media",src:e.picture},slot:"media"})])}))],1)},staticRenderFns:[]};var V=n("VU/8")({props:{},data:function(){return{paidBy:this.$store.state.payments.paidBy}},computed:{users:function(){return this.$store.getters.getMembersByGroupId(this.$f7router.currentRoute.params.id)}},methods:{commitPaidByToStore:function(t){this.$store.commit("updatePaidBy",""+t),this.$f7.views.main.router.back()}}},D,!1,function(t){n("kyt1")},"data-v-d6bbe562",null).exports,N={components:{PaymentFormUsers:V},name:"AddPaymentForm",props:{},data:function(){return{debt:[],paidTo:[],paidToIds:[],paidSum:"",debtors:{},description:"",transactions:[],globalUsers:[],groupUsers:[],editableSumId:"",pieSum:0,isEqually:!0,paidPies:{},updateBalances:{},currentPayUsersBalances:{}}},watch:{paidSum:function(){this.recalcSumPieces()}},computed:{paidId:{get:function(){return this.$store.state.payments.paidBy},set:function(t){this.$store.state.payments.paidBy=t}},paidBy:function(){var t=this;return this.users.find(function(e){return e.id===t.paidId})},users:function(){return this.$store.getters.getMembersByGroupId(this.$f7router.currentRoute.params.id)},allUsers:function(){return this.$store.getters.getUsers},allSelected:{get:function(){return!this.users||this.paidToIds.length===this.users.length},set:function(t){var e=[],n=[];t&&this.users.forEach(function(t){e.push(t),n.push(""+t.id)}),this.paidTo=e,this.paidToIds=n}}},created:function(){this.allSelected=!1},methods:{calcCurrentPayUsersBalances:function(){var t=this,e=[],n=function(n){e.push(t.users.find(function(t){return t.id===n}))};for(var r in this.paidPies)n(r);return e.reduce(function(t,e){return t[e.id]=e.balance,t},{})},editSumVisible:function(t){return t===this.editableSumId},editSum:function(t){var e=this;this.editableSumId=t,this.pieSum=0,this.$nextTick(function(){e.$refs["sum"+e.editableSumId][0].$el.children[0].focus()})},changeSum:function(t){var e=this;this.$f7.dialog.prompt("Введите сумму?",function(n){e.pieSum=+n,e.paidPies[t.id]=e.pieSum;var r=0;for(var s in e.paidPies)r+=e.paidPies[s];e.paidSum=r})},toggleCheckbox:function(t){this.paidToIds.includes(t)?this.paidToIds=this.paidToIds.filter(function(e){return e!==t}):this.paidToIds.push(t),!!this.paidPies[t]?(delete this.paidPies[t],this.recalcSumPieces()):this.calcUserSumPiece(t)},toggleEqually:function(){this.isEqually=!this.isEqually,this.recalcSumPieces()},calcUserSumPiece:function(t){this.isEqually?(this.paidPies[t]=this.paidSum/h()(this.paidPies).length,this.recalcSumPieces()):this.paidPies[t]=0},recalcSumPieces:function(){if(this.isEqually)for(var t in this.paidPies)this.paidPies[t]=this.paidSum/h()(this.paidPies).length},isSelected:function(t){return this.paidToIds.includes(""+t)},addPayment:function(){this.calculateBalance(),this.calculateDebtors(),this.createPayment(),this.updateUsers(),this.clean(),this.$router.push({name:this.$route.matched[this.$route.matched.length-2].name})},clean:function(){this.paidPies=[],this.paidId=null},calculateBalance:function(){this.currentPayUsersBalances=this.calcCurrentPayUsersBalances();var t={userId:this.paidBy.id,sum:+this.paidSum.toFixed(10)};for(var e in this.paidBy.balance=+(this.paidBy.balance+this.paidSum-this.paidPies[this.paidBy.id]).toFixed(10),this.paidPies)this.transactions.push({userId:e,sum:-this.paidPies[e].toFixed(10)}),this.updateBalances[e]=+(this.currentPayUsersBalances[e]-this.paidPies[e]).toFixed(10);void 0!==this.transactions.find(function(e){return e.userId===t.userId})?this.transactions.find(function(e){return e.userId===t.userId}).sum+=t.sum:this.transactions.push(t)},calculateDebtors:function(){var t=this,e=this.allUsers,n=JSON.parse(T()(e));n.forEach(function(e){!!t.updateBalances[e.id]&&(e.balance=t.updateBalances[e.id]),n.forEach(function(t){e.debtors[t.id]=0})}),n.find(function(e){return e.id===t.paidBy.id}).balance=t.paidBy.balance;var r=n.sort(function(t){return t.balance}),s=r.filter(function(t){return t.balance<0}),i=r.filter(function(t){return t.balance>=0}),a=[];s.forEach(function(t){t.pseudoBalance=t.balance}),i.forEach(function(t){t.pseudoBalance=t.balance}),s.forEach(function(t){var e=t.pseudoBalance;i.forEach(function(n){n.pseudoBalance>0&&e<0&&((e+=n.pseudoBalance)<=0?t.debtors[n.id]=-n.pseudoBalance:(t.debtors[n.id]=-(n.pseudoBalance-e),n.pseudoBalance-=n.pseudoBalance-e,t.pseudoBalance=0))}),i.sort(function(t){return t.pseudoBalance})}),s.forEach(function(t){a.push(t)}),i.forEach(function(t){a.push(t)}),a.forEach(function(t){n.forEach(function(e){t.id===e.id&&(e.debtors=t.debtors)})}),this.globalUsers=n,console.log(this.globalUsers)},calculateGroupDebtors:function(){this.groupUsers=JSON.parse(T()(this.$store.getters.getRecalculateMembersByGroupId(this.$f7router.currentRoute.params.id)));var t=this.groupUsers;t.forEach(function(e){t.forEach(function(t){e.debtors[t.id]=0})});var e=t.sort(function(t){return t.balance}),n=e.filter(function(t){return t.balance<0}),r=e.filter(function(t){return t.balance>=0}),s=[];n.forEach(function(t){t.pseudoBalance=t.balance}),r.forEach(function(t){t.pseudoBalance=t.balance}),n.forEach(function(t){var e=t.pseudoBalance;r.forEach(function(n){n.pseudoBalance>0&&e<0&&((e+=n.pseudoBalance)<=0?t.debtors[n.id]=-n.pseudoBalance:(t.debtors[n.id]=-(n.pseudoBalance-e),n.pseudoBalance-=n.pseudoBalance-e,t.pseudoBalance=0))}),r.sort(function(t){return t.pseudoBalance})}),n.forEach(function(t){s.push(t)}),r.forEach(function(t){s.push(t)}),s.forEach(function(e){t.forEach(function(t){e.name===t.name&&(t.debtors=e.debtors)})})},createPayment:function(){var t=this;return o()(i.a.mark(function e(){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.paidTo.map(function(t){return{userId:t.id,name:t.name}}),e.next=3,t.$store.dispatch("createPayment",{groupId:t.$f7router.currentRoute.params.id,description:t.description,sum:t.paidSum,paidBy:{userId:t.paidBy.id,name:t.paidBy.name},paidTo:n,transactions:t.transactions});case 3:t.calculateGroupDebtors(),t.updateGroup();case 5:case"end":return e.stop()}},e,t)}))()},updateUsers:function(){var t=this;this.globalUsers.forEach(function(e){t.$store.dispatch("updateUser",{id:e.id,balance:e.balance,debtors:e.debtors})})},updateGroup:function(){var t=[];this.groupUsers.forEach(function(e){t.push({id:e.id,debtors:e.debtors,balance:e.balance})}),this.$store.dispatch("updateGroup",{id:this.$f7router.currentRoute.params.id,members:t})}}},A={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{"back-link":"Back",title:"Новый платеж"}},[n("f7-nav-right",[n("f7-link",{on:{click:t.addPayment}},[t._v("Готово")])],1)],1),t._v(" "),n("f7-block-title",[t._v("Описание")]),t._v(" "),n("f7-list",[n("f7-list-item",[n("f7-input",{attrs:{"clear-button":"",placeholder:"Описание",type:"text",value:t.description},on:{input:function(e){t.description=e.target.value}}})],1)],1),t._v(" "),n("f7-block-title",[t._v("Кто платит")]),t._v(" "),n("f7-list",[t.paidId?t._e():n("f7-list-item",{attrs:{link:"#",title:"Кто платит"},on:{click:function(e){t.$f7.views.main.router.navigate({url:"/groups/"+t.$f7router.currentRoute.params.id+"/addpayment/paidby/"})}}}),t._v(" "),t.paidId?n("f7-list-item",{attrs:{link:"#",title:t.paidBy.name},on:{click:function(e){t.$f7.views.main.router.navigate({url:"/groups/"+t.$f7router.currentRoute.params.id+"/addpayment/paidby/"})}}},[n("img",{attrs:{slot:"media",src:t.paidBy.picture},slot:"media"})]):t._e()],1),t._v(" "),n("f7-block-title",[t._v("Сумма")]),t._v(" "),n("f7-list",[n("f7-list-item",[n("f7-input",{attrs:{"clear-button":"",value:Math.round10(t.paidSum,-2),type:"number",placeholder:"Сумма"},on:{input:function(e){t.paidSum=e.target.value}}})],1)],1),t._v(" "),n("f7-block-title",[t._v("За кого платят")]),t._v(" "),n("f7-list",[n("f7-list-item",{attrs:{title:"Делить поровну"}},[n("f7-toggle",{attrs:{checked:t.isEqually},on:{change:t.toggleEqually}})],1),t._v(" "),t._l(t.users,function(e){return n("f7-list-item",{key:e.id,attrs:{checkbox:"",title:e.name,value:e.id,checked:t.paidToIds.indexOf(e.id)>=0},on:{change:function(n){t.toggleCheckbox(e.id)}}},[n("img",{attrs:{slot:"media",src:e.picture},slot:"media"}),t._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[t._v("\n        Сумма: "+t._s(Math.round10(t.paidPies[e.id],-2))+t._s("  ")+"\n      ")]),t._v(" "),n("f7-button",{directives:[{name:"show",rawName:"v-show",value:!t.isEqually&&t.isSelected(e.id),expression:"!isEqually && isSelected(user.id)"}],staticClass:"col",attrs:{slot:"after",raised:""},on:{click:function(n){t.changeSum(e)}},slot:"after"},[t._v("\n        Изменить\n      ")])],1)})],2)],1)},staticRenderFns:[]};var q=n("VU/8")(N,A,!1,function(t){n("++uL"),n("yXuM")},"data-v-f91d7fca",null).exports,J={components:{GroupCard:M,HistoryCard:S,PaymentForm:q,UsersCard:g,DebtorsCard:P},props:{},data:function(){return{owesUsers:[]}},computed:{name:function(){return this.$f7router.currentRoute.params.id?this.$store.getters.getGroupById(this.$f7router.currentRoute.params.id)[0].name:""}},methods:{addPayment:function(){this.$f7.views.main.router.navigate({url:"/groups/"+this.$f7router.currentRoute.params.id+"/addpayment"})}}},H={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("f7-page",[n("f7-navbar",{attrs:{"back-link":"Back",title:t.name}},[n("f7-nav-right",[n("f7-link",{on:{click:t.addPayment}},[t._v("Добавить")])],1)],1),t._v(" "),n("f7-block-title",[t._v("\n    Члены\n  ")]),t._v(" "),n("users-card"),t._v(" "),n("f7-block-title",[t._v("\n    Должники\n  ")]),t._v(" "),n("debtors-card"),t._v(" "),n("f7-block-title",[t._v("\n    История платежей\n  ")]),t._v(" "),n("history-card")],1)},staticRenderFns:[]};var O={components:{HistoryCard:S},data:function(){return{}},computed:{payByMe:function(){return this.$store.getters.getPaymentsFromByUserId(this.$f7router.currentRoute.params.userId)},payToMe:function(){return this.$store.getters.getPaymentsToByUserId(this.$f7router.currentRoute.params.userId)},name:function(){return this.$store.getters.getNameByUserId(this.$f7router.currentRoute.params.userId)}},methods:{paidToUsers:function(t,e,n){var r="";return r+=t.name},paidToSum:function(t){var e=this;return void 0!==t.transactions.find(function(t){return t.userId===e.$f7router.currentRoute.params.userId})?t.transactions.find(function(t){return t.userId===e.$f7router.currentRoute.params.userId}).sum:0}}},z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v(t._s(t.name))])]),t._v(" "),n("f7-block-title",[t._v("Я платил")]),t._v(" "),n("history-card",{attrs:{payments:t.payByMe}}),t._v(" "),n("f7-block-title",[t._v("За меня платили")]),t._v(" "),n("history-card",{attrs:{payments:t.payToMe}})],1)},staticRenderFns:[]};var L=[{path:"/",name:"StartScreen",component:C},{path:"/groups/:id",props:!0,name:"GroupScreen",component:n("VU/8")(J,H,!1,function(t){n("WsN4")},"data-v-02785ea1",null).exports},{path:"/groups/:id/addpayment",name:"PaymentForm",component:q},{path:"/groups/:id/addpayment/paidby/",name:"PaymentFormUsers",component:V},{path:"/users/:userId/",name:"UserScreen",component:n("VU/8")(O,z,!1,function(t){n("zHIV")},null,null).exports},{path:"/adduser/",name:"UsersForm",component:f},{path:"/addgroup/",name:"GroupsForm",component:d}],j={name:"App",data:function(){return{f7params:{id:"io.pieapp.testapp",name:"PieApp",theme:"auto",routes:L,pushState:!0},pageStack:[],loading:!1}},created:function(){var t=this;this.$store.dispatch("fetchConnections").then(function(){t.$store.dispatch("fetchPayments").then(function(){t.$store.dispatch("fetchUsers").then(function(){t.$store.dispatch("fetchGroups").then(function(){t.loading=!0})})})})},computed:{},watch:{}},X={render:function(){var t=this.$createElement,e=this._self._c||t;return e("f7-app",{attrs:{params:this.f7params}},[e("f7-statusbar"),this._v(" "),this.loading?e("f7-view",{attrs:{url:"/",main:"",pushState:!0}}):this._e()],1)},staticRenderFns:[]};var Z=n("VU/8")(j,X,!1,function(t){n("JJq9")},null,null).exports,W=n("NYxO"),K=n("Dd8w"),Q=n.n(K),Y=n("Zrlr"),tt=n.n(Y),et=function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};tt()(this,t),this.name=e,this.picture=n,this.balance=r,this.debtors=s},nt={state:{users:[]},mutations:{fetchUsers:function(t,e){console.log("Mutation fetchUsers",e),t.users=e},createUser:function(t,e){console.log("Mutation createUser",e),t.users.push(Q()({},e))},updateUser:function(t,e){var n=e.id,r=e.balance,s=e.debtors;console.log("Mutation updateUser");var i=t.users.find(function(t){return t.id===n});i.balance=r,i.debtors=s}},actions:{fetchUsers:function(t,e){var n=this,r=t.commit,s=t.rootState;return o()(i.a.mark(function t(){var e,a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.db.collection("users"),t.next=3,e.get();case 3:a=t.sent,console.log("async fetchUsers",a),o=[],a.forEach(function(t){return o.push(Q()({id:t.id},t.data()))}),r("fetchUsers",o);case 8:case"end":return t.stop()}},t,n)}))()},createUser:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.name,u=e.picture;return o()(i.a.mark(function t(){var e,o,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new et(a,u),o=s.db.collection("users").add(Q()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createUser",c),r("createUser",Q()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()},updateUser:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.id,u=e.balance,c=e.debtors;return o()(i.a.mark(function t(){var e,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateUser",{id:a,balance:u,debtors:c}),e=s.db.collection("users").doc(a).update({balance:u,debtors:c}),t.next=4,e;case 4:o=t.sent,console.log("async updateUser",o),r("updateUser",{id:a,balance:u,debtors:c});case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getUsers:function(t){return t.users},getDebtors:function(t){var e=[],n=t.users;return n.forEach(function(t,r){var s=function(r){console.log(t.debtors[r]),t.debtors[r]<0&&e.push({who:{id:t.id,name:t.name,picture:t.picture},whom:{id:r,name:n.filter(function(t){return t.id===r})[0].name,picture:n.filter(function(t){return t.id===r})[0].picture},sum:t.debtors[r]})};for(var i in t.debtors)s(i)}),e},getNameByUserId:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0].name}},getPictureByUserId:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0].picture}},getUserById:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0]}}}},rt=function t(e,n){tt()(this,t),this.name=e,this.members=n},st={state:{groups:[]},mutations:{fetchGroups:function(t,e){console.log("Mutation fetchGroups",e),t.groups=e},createGroup:function(t,e){console.log("Mutation createGroup",e),t.groups.push(Q()({},e))},updateGroup:function(t,e){var n=e.id,r=e.members;console.log("Mutation updateGroup"),t.groups.find(function(t){return t.id===n}).members=r},updateGroupMember:function(t,e){var n=e.id,r=e.memberID,s=e.debtors,i=e.balance;console.log("Mutation updateGroupMember");var a=t.groups.find(function(t){return t.id===n}).members.find(function(t){return t.id===r});a.debtors=s,a.balance=i}},actions:{fetchGroups:function(t,e){var n=this,r=t.commit,s=t.rootState;return o()(i.a.mark(function t(){var e,a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.db.collection("groups");case 2:return e=t.sent,t.next=5,e.get();case 5:a=t.sent,console.log("async fetchGroups",a),o=[],a.forEach(function(t){return o.push(Q()({id:t.id},t.data()))}),r("fetchGroups",o);case 10:case"end":return t.stop()}},t,n)}))()},createGroup:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.name,u=e.members;return o()(i.a.mark(function t(){var e,o,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new rt(a,u),o=s.db.collection("groups").add(Q()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createGroup",c.id),r("createGroup",Q()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()},updateGroup:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.id,u=e.members;return o()(i.a.mark(function t(){var e,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateGroup",u),e=s.db.collection("groups").doc(a).update({members:u}),t.next=4,e;case 4:o=t.sent,console.log("async updatedGroup",o),r("updateGroup",{id:a,members:u});case 7:case"end":return t.stop()}},t,n)}))()},updateGroupMember:function(t,e){var n=this,r=t.commit,s=e.id,a=e.memberID,u=e.debtors,c=e.balance;return o()(i.a.mark(function t(){var e,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateGroup",s,a,u,c),t.next=3,fetch("http://localhost:3000/groups/"+s,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:T()({id:s,members:{id:a,debtors:u,balance:c}})});case 3:return e=t.sent,t.next=6,e.json();case 6:o=t.sent,console.log("async updateGroupMember",o),r("updateGroupMember",o);case 9:case"end":return t.stop()}},t,n)}))()}},getters:{getGroups:function(t){return t.groups},getGroupById:function(t,e){return function(e){return console.log("Вызов getGroupById"),t.groups.filter(function(t){return t.id===e})}},getDebtorsByGroupId:function(t,e,n,r){return function(t){console.log("Вызов getDebtorsByGroupId");var n=[],s=e.getGroupById(t)[0].members;return s.forEach(function(t,e){var i=function(e){t.debtors[e]<0&&n.push({who:{id:t.id,name:r.getNameByUserId(t.id),picture:r.getPictureByUserId(t.id)},whom:{id:e,name:r.getNameByUserId(s.filter(function(t){return t.id===e})[0].id),picture:r.getPictureByUserId(s.filter(function(t){return t.id===e})[0].id)},sum:t.balance})};for(var a in t.debtors)i(a)}),n}}}},it=function t(e,n,r,s,i,a){tt()(this,t),this.groupId=e,this.description=n,this.sum=r,this.paidBy=s,this.paidTo=i,this.transactions=a},at={state:{payments:[],paidBy:""},mutations:{updatePaidBy:function(t,e){t.paidBy=e},fetchPayments:function(t,e){console.log("Mutation fetchPayments",e),t.payments=e},createPayment:function(t,e){console.log("Mutation createPayment",e),t.payments.push(Q()({},e))}},actions:{fetchPayments:function(t,e){var n=this,r=t.commit,s=t.rootState;return o()(i.a.mark(function t(){var e,a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=s.db.collection("payments"),t.next=3,e.get();case 3:a=t.sent,console.log("async fetchPayments",a),o=[],a.forEach(function(t){return o.push(Q()({id:t.id},t.data()))}),r("fetchPayments",o);case 8:case"end":return t.stop()}},t,n)}))()},createPayment:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.groupId,u=e.description,c=e.sum,d=e.paidBy,l=e.paidTo,p=e.transactions;return o()(i.a.mark(function t(){var e,o,f;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new it(a,u,c,d,l,p),o=s.db.collection("payments").add(Q()({},e)),t.next=4,o;case 4:f=t.sent,console.log("async createPayment",f),r("createPayment",Q()({id:f.id},e));case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getPayments:function(t){return t.payments},getPaymentByGroupId:function(t,e){return function(e){return console.log("Вызов getPaymentByGroupId",e),t.payments.filter(function(t){return t.groupId===e})}},getPaymentsFromByUserId:function(t,e){return function(e){return console.log("Вызов getPaymentsFromByUserId",e),t.payments.filter(function(t){return t.paidBy.userId===e})}},getPaymentsToByUserId:function(t,e){return function(e){return console.log("Вызов getPaymentsToByUserId",e),t.payments.filter(function(t){return t.paidBy.userId!==e&&t.paidTo.filter(function(t){return t.userId===e}).length})}},getRecalculateMembersByGroupId:function(t,e,n,r){return function(t){var n=r.getMembersByGroupId(t);console.log("Вызов getRecalculateMembersByGroupId",t);var s=e.getPaymentByGroupId(t),i=JSON.parse(T()(n));return i.map(function(t){t.balance=0}),i.forEach(function(t){s.forEach(function(e){return e.transactions.forEach(function(e){e.userId===t.id&&(t.balance+=e.sum)})})}),i}}}},ot=function t(e,n){tt()(this,t),this.groupId=e,this.userId=n},ut={state:{connections:[]},mutations:{fetchConnections:function(t,e){console.log("Mutation fetchConnections",e),t.connections=e},createConnection:function(t,e){console.log("Mutation createConnection",e),t.connections.push(Q()({},e))}},actions:{fetchConnections:function(t,e){var n=this,r=t.commit,s=t.rootState;return o()(i.a.mark(function t(){var e,a,o;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s.db.collection("connections");case 2:return e=t.sent,t.next=5,e.get();case 5:a=t.sent,console.log("fetchConnections",a),o=[],a.forEach(function(t){return o.push(Q()({id:t.id},t.data()))}),r("fetchConnections",o);case 10:case"end":return t.stop()}},t,n)}))()},createConnection:function(t,e){var n=this,r=t.commit,s=t.rootState,a=e.groupId,u=e.userId;return o()(i.a.mark(function t(){var e,o,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new ot(a,u),o=s.db.collection("connections").add(Q()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createConnection",c.id),r("createConnection",Q()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getMembersByGroupId:function(t,e,n){return function(e){console.log("Вызов getMembersByGroupId",e);var r=[];return t.connections.filter(function(t){return t.groupId===e}).map(function(t){r.push(n.users.users.find(function(e){return e.id===t.userId}))}),r}}}},ct=n("g9Xd"),dt=n.n(ct);n("bxnb");dt.a.initializeApp({apiKey:"AIzaSyBk6M90VAqEL6L7fsZZW1DN7ndRS9HQ8gw",authDomain:"pie-app-2018.firebaseapp.com",databaseURL:"https://pie-app-2018.firebaseio.com",projectId:"pie-app-2018",storageBucket:"pie-app-2018.appspot.com",messagingSenderId:"724148888563"}),r.a.use(W.a);var lt={db:dt.a.firestore()};lt.db.settings({timestampsInSnapshots:!0});var pt=new W.a.Store({state:lt,modules:{users:nt,groups:st,payments:at,connections:ut}}),ft=n("GLwI"),mt=n("+zVC");n("VzBF");ft.a.use(mt.a),Math.round10||(Math.round10=function(t,e){return function(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+n:n))))}("round",t,e)}),r.a.config.productionTip=!1;e.default=new r.a({el:"#app",store:pt,components:{App:Z},template:"<App/>"})},OBvC:function(t,e){},UK6u:function(t,e){},VzBF:function(t,e){},WsN4:function(t,e){},h09z:function(t,e){},kyt1:function(t,e){},rcZV:function(t,e){},u2dc:function(t,e){},whbx:function(t,e){},yXuM:function(t,e){},zHIV:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.d71a793d141966599d6f.js.map