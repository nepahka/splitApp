webpackJsonp([1],{"/+D3":function(t,e){},"5TG4":function(t,e){},"9iJ3":function(t,e){},ALqh:function(t,e){},JXub:function(t,e){},Mop9:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("7+uW"),r={name:"App",data:function(){return{pageStack:[],loading:!1}},created:function(){var t=this;this.$store.dispatch("fetchConnections").then(function(){t.$store.dispatch("fetchPayments").then(function(){t.$store.dispatch("fetchUsers").then(function(){t.$store.dispatch("fetchGroups").then(function(){t.loading=!0})})})});var e=function(e){return t.pageStack=e.matched.map(function(t){return t.components.default})};e(this.$route),this.$router.beforeEach(function(t,n,s){return e(t)&&s()})},computed:{},methods:{goBack:function(){console.log(this.$route.matched[this.$route.matched.length-2].name),this.$router.push({name:this.$route.matched[this.$route.matched.length-2].name})}},watch:{}},i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[this.loading?e("v-ons-navigator",{attrs:{swipeable:"","page-stack":this.pageStack,"pop-page":this.goBack}}):this._e()],1)},staticRenderFns:[]};var a=n("VU/8")(r,i,!1,function(t){n("Ol6Z")},null,null).exports,o=n("/ocq"),c=n("Xxa5"),u=n.n(c),d=n("exGp"),l=n.n(d),p={name:"GroupsForm",props:{},data:function(){return{name:"",members:[]}},computed:{users:function(){return this.$store.getters.getUsers},groups:function(){return this.$store.getters.getGroups}},methods:{addGroup:function(){var t=this;return l()(u.a.mark(function e(){var n,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],t.members.map(function(t){n.push({id:t,debtors:{},balance:0})}),e.next=4,t.$store.dispatch("createGroup",{name:t.name,members:n});case 4:s=t.groups[t.groups.length-1].id,t.members.map(function(e){t.$store.dispatch("createConnection",{groupId:s,userId:e})}),t.$router.push({name:t.$route.matched[t.$route.matched.length-2].name});case 7:case"end":return e.stop()}},e,t)}))()},toggleCheckbox:function(t){this.members.includes(t.id)?this.members.splice(this.members.findIndex(function(e){return e===t.id}),1):this.members.push(t.id)},isSelected:function(t){return this.members.includes(t.id)}}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v("Новая группа")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-toolbar-button",{on:{click:t.addGroup}},[t._v("\n        Готово\n      ")])],1)]),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[t._v("Имя")]),t._v(" "),n("v-ons-list",[n("v-ons-list-item",[n("v-ons-input",{attrs:{float:"",type:"text",placeholder:"Имя"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1)],1),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[t._v("Члены")]),t._v(" "),n("v-ons-list",t._l(t.users,function(e,s){return n("v-ons-list-item",{key:e.id,on:{click:function(n){t.toggleCheckbox(e)}}},[n("div",{staticClass:"left"},[n("img",{attrs:{src:e.picture}})]),t._v(" "),n("div",{staticClass:"center"},[t._v("\n        "+t._s(e.name)+"\n      ")]),t._v(" "),n("div",{staticClass:"right list-item__right"},[n("v-ons-checkbox",{attrs:{"input-id":"members-"+s,value:e.id,checked:t.isSelected(e)}})],1)])}))],1)},staticRenderFns:[]};var f=n("VU/8")(p,m,!1,function(t){n("T2jN")},"data-v-0e0276e5",null).exports,h={name:"UsersForm",props:{},data:function(){return{name:"",picture:""}},computed:{},created:function(){this.getPicture()},methods:{addUser:function(){var t=this;return l()(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$router.push({name:t.$route.matched[t.$route.matched.length-2].name}),e.next=3,t.createUser();case 3:case"end":return e.stop()}},e,t)}))()},getPicture:function(){var t=this;return l()(u.a.mark(function e(){var n,s;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.randomuser.me/?lego");case 2:return n=e.sent,e.next=5,n.json();case 5:s=e.sent,t.picture=s.results[0].picture.thumbnail;case 7:case"end":return e.stop()}},e,t)}))()},createUser:function(){this.$store.dispatch("createUser",{name:this.name,picture:this.picture})}}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v("Новый пользователь")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-toolbar-button",{on:{click:t.addUser}},[t._v("\n        Готово\n      ")])],1)]),t._v(" "),n("v-ons-list",[n("v-ons-list-item",[n("div",{staticClass:"left"},[n("img",{attrs:{src:t.picture}})]),t._v(" "),n("div",{staticClass:"center"},[n("v-ons-list",{attrs:{modifier:"noborder"}},[n("v-ons-list-item",[n("v-ons-input",{attrs:{placeholder:"Имя",float:"",type:"text"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}})],1),t._v(" "),n("v-ons-list-item",[n("v-ons-input",{attrs:{placeholder:"Email",float:"",type:"text"}})],1)],1)],1)])],1)],1)},staticRenderFns:[]};var b=n("VU/8")(h,v,!1,function(t){n("Mop9")},"data-v-606b08c0",null).exports,g={props:{},data:function(){return{}},computed:{members:function(){return console.log("USERS CARD"),this.$route.params.id?this.$store.getters.getGroupById(this.$route.params.id)[0].members:this.$store.getters.getUsers}},methods:{picture:function(t){return this.$store.getters.getPictureByUserId(t)},name:function(t){return this.$store.getters.getNameByUserId(t)},openUserScreen:function(t){this.$router.push("/users/"+t)}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-list",t._l(t.members,function(e){return n("v-ons-list-item",{key:e.id,attrs:{tappable:""},on:{click:function(n){t.openUserScreen(e.id)}}},[n("div",{staticClass:"left"},[n("img",{attrs:{src:t.picture(e.id)}})]),t._v(" "),n("div",{staticClass:"center"},[t._v("\n      "+t._s(t.name(e.id))+" : "+t._s(e.balance)+"\n    ")]),t._v(" "),n("div",{staticClass:"right list-item__right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-arrow-forward, material:md-arrow-forward"}})],1)])}))},staticRenderFns:[]};var y=n("VU/8")(g,_,!1,function(t){n("y+uo")},"data-v-5d25bef4",null).exports,$={props:{groups:Array},data:function(){return{}},computed:{},methods:{members:function(t){return this.$store.getters.getMembersByGroupId(t)},balance:function(t){return this.$store.getters.getPaymentByGroupId(t).reduce(function(t,e){return t+e.sum},0)},openGroup:function(t){this.$router.push("/groups/"+t)}}},U={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-list",t._l(t.groups,function(e){return n("v-ons-list-item",{key:e.id,on:{click:function(n){t.openGroup(e.id)}}},[n("div",{staticClass:"center"},[t._v("\n      "+t._s(e.name)+"\n      "+t._s(t.balance(e.id))+"\n    ")]),t._v(" "),n("div",{staticClass:"right"},t._l(t.members(e.id),function(t){return n("img",{attrs:{src:t.picture}})})),t._v(" "),n("div",{staticClass:"right list-item__right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-arrow-forward, material:md-arrow-forward"}})],1)])}))},staticRenderFns:[]};var B=n("VU/8")($,U,!1,function(t){n("Uqx4")},"data-v-9d2a1d7c",null).exports,I={props:{user:Object},data:function(){return{isVisible:!0}},methods:{onCancel:function(){this.$emit("onCancel")},onConfirm:function(){this.$emit("onConfirm")}}},C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-alert-dialog",{attrs:{modifier:"rowfooter",visible:t.isVisible},on:{"update:visible":function(e){t.isVisible=e}}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v("Списать долг")]),t._v("\n  "+t._s(t.user.who.name)+" перед "+t._s(t.user.whom.name)+"?\n  "),n("template",{slot:"footer"},[n("v-ons-alert-dialog-button",{on:{click:t.onCancel}},[t._v("Нет")]),t._v(" "),n("v-ons-alert-dialog-button",{on:{click:t.onConfirm}},[t._v("Да")])],1)],2)},staticRenderFns:[]};var w={components:{ConfirmModal:n("VU/8")(I,C,!1,function(t){n("JXub")},null,null).exports},props:{},data:function(){return{confirmModal:!1,isGroup:!1,debtUser:null}},watch:{},computed:{debtors:function(){return console.log("DEBTORS CARD"),this.$route.params.id?(this.isGroup=!0,this.$store.getters.getDebtorsByGroupId(this.$route.params.id)):(this.isGroup=!1,this.$store.getters.getDebtors)}},methods:{confirmSettleDebt:function(t){this.confirmModal=!0,this.debtUser=t},cancelSettleDebt:function(){this.confirmModal=!1,this.debtUser=null},settleDebt:function(t){var e=this,n=t.sum,s=t.who,r=t.whom;this.confirmModal=!1;var i=this.$store.getters.getUsers.find(function(t){return t.id===s.id}),a=this.$store.getters.getUsers.find(function(t){return t.id===r.id});console.log("settleDebt",n,s,r),i.balance-=n,i.debtors[r.id]=0,a.balance+=n,this.$store.dispatch("updateUser",{id:i.id,balance:i.balance,debtors:i.debtors}),this.$store.dispatch("updateUser",{id:a.id,balance:a.balance,debtors:a.debtors}),this.$store.getters.getGroups.map(function(t){var n=[],i=0;t.members.map(function(t){t.id===s.id&&(i=t.balance,t.balance=0,t.debtors[r.id]=0),t.id===r.id&&(t.balance+=i),n.push({id:t.id,debtors:t.debtors,balance:t.balance})}),e.$store.dispatch("updateGroup",{id:t.id,members:n})}),this.$store.dispatch("createPayment",{groupId:0,description:"Списан долг",sum:-1*n,paidBy:{userId:s.id,name:s.name},paidTo:[{userId:r.id,name:r.name}],transactions:[{userId:s.id,sum:-1*n},{userId:r.id,sum:n}]})},settleGroupDebt:function(t){var e=t.sum,n=t.who,s=t.whom;this.confirmModal=!1;var r=this.$store.getters.getUsers.find(function(t){return t.id===n.id}),i=this.$store.getters.getUsers.find(function(t){return t.id===s.id});console.log("settleGroupDebt",e,n,s),r.balance-=e,i.balance+=e,i.debtors[n.id]+=e,this.$store.dispatch("updateUser",{id:r.id,balance:r.balance,debtors:r.debtors}),this.$store.dispatch("updateUser",{id:i.id,balance:i.balance,debtors:i.debtors});var a=[],o=0;this.$store.getters.getGroupById(this.$route.params.id)[0].members.map(function(t){t.id===n.id&&(o=t.balance,t.balance=0,t.debtors[s.id]=0),t.id===s.id&&(t.balance+=o),a.push({id:t.id,debtors:t.debtors,balance:t.balance})}),this.$store.dispatch("updateGroup",{id:this.$route.params.id,members:a}),this.$store.dispatch("createPayment",{groupId:this.$route.params.id,description:"Списан долг",sum:-1*e,paidBy:{userId:n.id,name:n.name},paidTo:[{userId:s.id,name:s.name}],transactions:[{userId:n.id,sum:-1*e},{userId:s.id,sum:e}]})}}},P={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-list",{staticClass:"debtors-card"},t._l(t.debtors,function(e){return n("v-ons-list-item",{key:e.id},[n("div",{staticClass:"center"},[n("b",[t._v(t._s(e.who.name))]),t._v(" "),n("img",{attrs:{src:e.who.picture}}),t._v("\n      должен\n      "),n("b",[t._v(t._s(e.whom.name))]),t._v(" "),n("img",{attrs:{src:e.whom.picture}}),t._v(" "),n("span",{staticClass:"sum"},[t._v(": "+t._s(-Math.round10(e.sum,-2)))])]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-arrow-dropup, material:md-arrow-dropup",size:"18px, material: 18px"},on:{click:function(n){t.confirmSettleDebt(e)}}})],1),t._v(" "),t.confirmModal?n("confirm-modal",{attrs:{user:t.debtUser},on:{onCancel:t.cancelSettleDebt,onConfirm:function(e){t.isGroup?t.settleGroupDebt(t.debtUser):t.settleDebt(t.debtUser)}}}):t._e()],1)}))},staticRenderFns:[]};var S=n("VU/8")(w,P,!1,function(t){n("9iJ3")},"data-v-a18a4394",null).exports,G={props:{payments:Array},data:function(){return{}},computed:{currentPayments:function(){return this.$route.params.id?this.$store.getters.getPaymentByGroupId(this.$route.params.id):this.payments}},methods:{showPaymentModal:function(){this.$emit("showPaymentModal",!0)},paidToUsers:function(t,e,n){var s="";return s+=t.name}}},x={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-list",t._l(t.currentPayments,function(e){return n("v-ons-list-item",{key:e.id},[n("div",{staticClass:"center"},[n("span",{staticClass:"list-item__title"},[t._v(t._s(e.description))]),t._v(" "),n("span",{staticClass:"list-item__subtitle"},[t._v("\n        "+t._s(e.paidBy.name)+" заплатил за\n        "),t._l(e.paidTo,function(e,s){return n("span",{key:e.id},[t._v("\n          "+t._s(t.paidToUsers(e,s))+"\n        ")])})],2)]),t._v(" "),n("div",{staticClass:"right"},[t._v("\n      "+t._s(e.sum)+"\n    ")])])}))},staticRenderFns:[]};var k=n("VU/8")(G,x,!1,function(t){n("ORgj")},null,null).exports,E={components:{GroupsForm:f,UsersForm:b,UsersCard:y,GroupsCard:B,DebtorsCard:S,HistoryCard:k},props:{},data:function(){return{isUsersFormVisible:!1,isGroupsFormVisible:!1,owesUsers:[]}},computed:{users:function(){return this.$store.getters.getUsers},groups:function(){return this.$store.getters.getGroups}},methods:{addGroup:function(){this.isGroupsFormVisible=!1}}},M={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"center"},[t._v("PieApp")])]),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("Группы")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-add, material:md-add"},on:{click:function(e){t.$router.push({name:"GroupsForm"})}}})],1)]),t._v(" "),n("groups-card",{attrs:{groups:t.groups}}),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("Пользователи")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-add, material:md-add"},on:{click:function(e){t.$router.push({name:"UsersForm"})}}})],1)]),t._v(" "),n("users-card",{attrs:{users:t.users}}),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("Должники")])]),t._v(" "),n("debtors-card",{attrs:{users:t.users}})],1)},staticRenderFns:[]};var F=n("VU/8")(E,M,!1,function(t){n("/+D3")},"data-v-c00074e8",null).exports,T={render:function(){var t=this.$createElement,e=this._self._c||t;return e("v-ons-list",[e("v-ons-list-item",[e("div",{staticClass:"left"}),this._v(" "),e("div",{staticClass:"center"},[this._v("\n      "+this._s(this.name)+"\n    ")])])],1)},staticRenderFns:[]};var D=n("VU/8")({props:{},data:function(){return{}},computed:{name:function(){return this.$route.params.id?this.$store.getters.getGroupById(this.$route.params.id)[0].name:""}}},T,!1,function(t){n("5TG4")},null,null).exports,V=n("mvHQ"),R=n.n(V),N=n("fZjL"),q=n.n(N),A={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v("Кто платит")])]),t._v(" "),n("v-ons-list",t._l(t.users,function(e,s){return n("v-ons-list-item",{key:e.id,attrs:{tappable:""}},[n("label",{staticClass:"left"},[n("v-ons-radio",{attrs:{"input-id":"radio-"+s,value:e.id},on:{change:function(n){t.commitPaidByToStore(e.id)}},model:{value:t.paidBy,callback:function(e){t.paidBy=e},expression:" paidBy"}})],1),t._v(" "),n("label",{staticClass:"left",attrs:{for:"radio-"+s}},[n("img",{attrs:{src:e.picture}})]),t._v(" "),n("label",{staticClass:"center",attrs:{for:"radio-"+s}},[t._v("\n        "+t._s(e.name)+"\n      ")])])}))],1)},staticRenderFns:[]};var j=n("VU/8")({props:{},data:function(){return{paidBy:this.$store.state.payments.paidBy}},computed:{users:function(){return this.$store.getters.getMembersByGroupId(this.$route.params.id)}},methods:{commitPaidByToStore:function(t){this.$router.go(-1),this.$store.commit("updatePaidBy",""+t)}}},A,!1,function(t){n("ALqh")},"data-v-3dfce9f2",null).exports,O={components:{PaymentFormUsers:j},name:"AddPaymentForm",props:{},data:function(){return{debt:[],paidTo:[],paidToIds:[],paidSum:"",debtors:{},description:"",transactions:[],globalUsers:[],groupUsers:[],editableSumId:"",pieSum:0,isEqually:!0,paidPies:{},updateBalances:{},currentPayUsersBalances:{}}},watch:{paidSum:function(){this.recalcSumPieces()}},computed:{paidId:{get:function(){return this.$store.state.payments.paidBy},set:function(t){this.$store.state.payments.paidBy=t}},paidBy:function(){var t=this;return this.users.find(function(e){return e.id===t.paidId})},users:function(){return this.$store.getters.getMembersByGroupId(this.$route.params.id)},allUsers:function(){return this.$store.getters.getUsers},allSelected:{get:function(){return!this.users||this.paidToIds.length===this.users.length},set:function(t){var e=[],n=[];t&&this.users.forEach(function(t){e.push(t),n.push(""+t.id)}),this.paidTo=e,this.paidToIds=n}}},created:function(){this.allSelected=!1},methods:{calcCurrentPayUsersBalances:function(){var t=this,e=[],n=function(n){e.push(t.users.find(function(t){return t.id===n}))};for(var s in this.paidPies)n(s);return e.reduce(function(t,e){return t[e.id]=e.balance,t},{})},editSumVisible:function(t){return t===this.editableSumId},editSum:function(t){var e=this;this.editableSumId=t,this.pieSum=0,this.$nextTick(function(){e.$refs["sum"+e.editableSumId][0].$el.children[0].focus()})},changeSum:function(t){this.paidPies[t.id]=this.pieSum;var e=0;for(var n in this.paidPies)e+=this.paidPies[n];this.paidSum=e},toggleCheckbox:function(t){!!this.paidPies[t]?(delete this.paidPies[t],this.recalcSumPieces()):this.calcUserSumPiece(t)},calcUserSumPiece:function(t){this.isEqually?(this.paidPies[t]=this.paidSum/q()(this.paidPies).length,this.recalcSumPieces()):this.paidPies[t]=0},recalcSumPieces:function(){if(this.isEqually)for(var t in this.paidPies)this.paidPies[t]=this.paidSum/q()(this.paidPies).length},isSelected:function(t){return this.paidToIds.includes(""+t)},addPayment:function(){this.calculateBalance(),this.calculateDebtors(),this.createPayment(),this.updateUsers(),this.clean(),this.$router.push({name:this.$route.matched[this.$route.matched.length-2].name})},clean:function(){this.paidPies=[],this.paidId=null},calculateBalance:function(){this.currentPayUsersBalances=this.calcCurrentPayUsersBalances();var t={userId:this.paidBy.id,sum:+this.paidSum.toFixed(10)};for(var e in this.paidBy.balance=+(this.paidBy.balance+this.paidSum-this.paidPies[this.paidBy.id]).toFixed(10),this.paidPies)this.transactions.push({userId:e,sum:-this.paidPies[e].toFixed(10)}),this.updateBalances[e]=+(this.currentPayUsersBalances[e]-this.paidPies[e]).toFixed(10);void 0!==this.transactions.find(function(e){return e.userId===t.userId})?this.transactions.find(function(e){return e.userId===t.userId}).sum+=t.sum:this.transactions.push(t)},calculateDebtors:function(){var t=this,e=this.allUsers,n=JSON.parse(R()(e));n.forEach(function(e){!!t.updateBalances[e.id]&&(e.balance=t.updateBalances[e.id]),n.forEach(function(t){e.debtors[t.id]=0})}),n.find(function(e){return e.id===t.paidBy.id}).balance=t.paidBy.balance;var s=n.sort(function(t){return t.balance}),r=s.filter(function(t){return t.balance<0}),i=s.filter(function(t){return t.balance>=0}),a=[];r.forEach(function(t){t.pseudoBalance=t.balance}),i.forEach(function(t){t.pseudoBalance=t.balance}),r.forEach(function(t){var e=t.pseudoBalance;i.forEach(function(n){n.pseudoBalance>0&&e<0&&((e+=n.pseudoBalance)<=0?t.debtors[n.id]=-n.pseudoBalance:(t.debtors[n.id]=-(n.pseudoBalance-e),n.pseudoBalance-=n.pseudoBalance-e,t.pseudoBalance=0))}),i.sort(function(t){return t.pseudoBalance})}),r.forEach(function(t){a.push(t)}),i.forEach(function(t){a.push(t)}),a.forEach(function(t){n.forEach(function(e){t.id===e.id&&(e.debtors=t.debtors)})}),this.globalUsers=n,console.log(this.globalUsers)},calculateGroupDebtors:function(){this.groupUsers=JSON.parse(R()(this.$store.getters.getRecalculateMembersByGroupId(this.$route.params.id)));var t=this.groupUsers;t.forEach(function(e){t.forEach(function(t){e.debtors[t.id]=0})});var e=t.sort(function(t){return t.balance}),n=e.filter(function(t){return t.balance<0}),s=e.filter(function(t){return t.balance>=0}),r=[];n.forEach(function(t){t.pseudoBalance=t.balance}),s.forEach(function(t){t.pseudoBalance=t.balance}),n.forEach(function(t){var e=t.pseudoBalance;s.forEach(function(n){n.pseudoBalance>0&&e<0&&((e+=n.pseudoBalance)<=0?t.debtors[n.id]=-n.pseudoBalance:(t.debtors[n.id]=-(n.pseudoBalance-e),n.pseudoBalance-=n.pseudoBalance-e,t.pseudoBalance=0))}),s.sort(function(t){return t.pseudoBalance})}),n.forEach(function(t){r.push(t)}),s.forEach(function(t){r.push(t)}),r.forEach(function(e){t.forEach(function(t){e.name===t.name&&(t.debtors=e.debtors)})})},createPayment:function(){var t=this;return l()(u.a.mark(function e(){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.paidTo.map(function(t){return{userId:t.id,name:t.name}}),e.next=3,t.$store.dispatch("createPayment",{groupId:t.$route.params.id,description:t.description,sum:t.paidSum,paidBy:{userId:t.paidBy.id,name:t.paidBy.name},paidTo:n,transactions:t.transactions});case 3:t.calculateGroupDebtors(),t.updateGroup();case 5:case"end":return e.stop()}},e,t)}))()},updateUsers:function(){var t=this;this.globalUsers.forEach(function(e){t.$store.dispatch("updateUser",{id:e.id,balance:e.balance,debtors:e.debtors})})},updateGroup:function(){var t=[];this.groupUsers.forEach(function(e){t.push({id:e.id,debtors:e.debtors,balance:e.balance})}),this.$store.dispatch("updateGroup",{id:this.$route.params.id,members:t})}}},J={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v("Новый платеж")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-toolbar-button",{on:{click:t.addPayment}},[t._v("\n        Готово\n      ")])],1)]),t._v(" "),n("br"),t._v(" "),n("v-ons-list",[n("v-ons-list-item",[n("div",{staticClass:"center"},[n("v-ons-input",{attrs:{float:"",placeholder:"Описание"},model:{value:t.description,callback:function(e){t.description=e},expression:"description"}})],1)])],1),t._v(" "),n("br"),t._v(" "),n("v-ons-list",[t.paidId?t._e():n("v-ons-list-item",{on:{click:function(e){t.$router.push({name:"PaymentFormUsers"})}}},[n("div",{staticClass:"center list-item__left",staticStyle:{color:"#999"}},[t._v("\n        Кто платит\n      ")]),t._v(" "),n("div",{staticClass:"right list-item__right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-arrow-forward, material:md-forward"}})],1)]),t._v(" "),t.paidId?n("v-ons-list-item",{on:{click:function(e){t.$router.push({name:"PaymentFormUsers"})}}},[n("div",{staticClass:"left list-item__left"},[n("img",{attrs:{src:t.paidBy.picture}})]),t._v(" "),n("div",{staticClass:"center list-item__center"},[t._v("\n        "+t._s(t.paidBy.name)+"\n      ")]),t._v(" "),n("div",{staticClass:"right list-item__right"},[n("v-ons-icon",{attrs:{icon:"ion-ios-arrow-forward, material:md-forward"}})],1)]):t._e()],1),t._v(" "),n("br"),t._v(" "),n("v-ons-list",[n("v-ons-list-item",[n("div",{staticClass:"center"},[n("v-ons-input",{attrs:{float:"",type:"number",placeholder:"Сумма"},model:{value:t.paidSum,callback:function(e){t.paidSum=t._n(e)},expression:"paidSum"}})],1)])],1),t._v(" "),n("br"),t._v(" "),n("v-ons-list",[n("ons-list-item",[n("label",{staticClass:"center",attrs:{for:"switch1"}},[t._v("\n        Делить поровну\n      ")]),t._v(" "),n("div",{staticClass:"right switch-item"},[n("v-ons-switch",{attrs:{"input-id":"switch1"},model:{value:t.isEqually,callback:function(e){t.isEqually=e},expression:"isEqually"}})],1)]),t._v(" "),t._l(t.users,function(e,s){return n("v-ons-list-item",{key:e.id},[n("label",{staticClass:"left"},[n("v-ons-checkbox",{attrs:{"input-id":"paidto-"+s,value:e.id},on:{change:function(n){t.toggleCheckbox(e.id)}},model:{value:t.paidToIds,callback:function(e){t.paidToIds=e},expression:"paidToIds"}})],1),t._v(" "),n("label",{staticClass:"left",attrs:{for:"paidto-"+s}},[n("img",{attrs:{src:e.picture}})]),t._v(" "),n("label",{staticClass:"center",attrs:{for:"paidto-"+s}},[t._v("\n        "+t._s(e.name)+"\n      ")]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.isSelected(e.id)&&!t.editSumVisible(e.id),expression:"isSelected(user.id) && !editSumVisible(user.id)"}],staticClass:"right"},[t._v("\n        "+t._s(t.paidPies[e.id])+t._s("  ")+"\n        "),n("v-ons-icon",{directives:[{name:"show",rawName:"v-show",value:!t.isEqually,expression:"!isEqually"}],attrs:{icon:"ion-ios-color-wand, material:md-color-wand"},on:{click:function(n){t.editSum(e.id)}}})],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:t.editSumVisible(e.id),expression:"editSumVisible(user.id)"}],staticClass:"right"},[n("v-ons-input",{ref:"sum"+e.id,refInFor:!0,attrs:{float:"",type:"number",placeholder:""},on:{change:function(n){t.changeSum(e)},blur:function(e){t.editableSumId=""},keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.editableSumId=""}},model:{value:t.pieSum,callback:function(e){t.pieSum=t._n(e)},expression:"pieSum"}})],1)])})],2)],1)},staticRenderFns:[]};var H=n("VU/8")(O,J,!1,function(t){n("zwqg"),n("QQJq")},"data-v-56940648",null).exports,L={components:{GroupCard:D,HistoryCard:k,PaymentForm:H,UsersCard:y,DebtorsCard:S},props:{},data:function(){return{isPaymentFormVisible:!1,owesUsers:[]}},computed:{name:function(){return this.$route.params.id?this.$store.getters.getGroupById(this.$route.params.id)[0].name:""}},methods:{addHistory:function(){this.isPaymentFormVisible=!1}}},Q={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v("\n      "+t._s(t.name)+"\n    ")]),t._v(" "),n("div",{staticClass:"right"},[n("v-ons-toolbar-button",{on:{click:function(e){t.$router.push({name:"PaymentForm"})}}},[t._v("\n        Платеж\n      ")])],1)]),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("Члены")])]),t._v(" "),n("users-card"),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("Должники")])]),t._v(" "),n("debtors-card"),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[n("div",{staticClass:"left"},[t._v("История платежей")])]),t._v(" "),n("history-card")],1)},staticRenderFns:[]};var X=n("VU/8")(L,Q,!1,function(t){n("qYcj")},"data-v-10ba656b",null).exports,Z={components:{HistoryCard:k},data:function(){return{}},computed:{payByMe:function(){return this.$store.getters.getPaymentsFromByUserId(this.$route.params.userId)},payToMe:function(){return this.$store.getters.getPaymentsToByUserId(this.$route.params.userId)},name:function(){return this.$store.getters.getNameByUserId(this.$route.params.userId)}},methods:{paidToUsers:function(t,e,n){var s="";return s+=t.name},paidToSum:function(t){var e=this;return void 0!==t.transactions.find(function(t){return t.userId===e.$route.params.userId})?t.transactions.find(function(t){return t.userId===e.$route.params.userId}).sum:0}}},z={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-ons-page",[n("v-ons-toolbar",[n("div",{staticClass:"left"},[n("ons-back-button",[t._v("Назад")])],1),t._v(" "),n("div",{staticClass:"center"},[t._v(t._s(t.name))])]),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[t._v("Я платил")]),t._v(" "),n("history-card",{attrs:{payments:t.payByMe}}),t._v(" "),n("br"),t._v(" "),n("v-ons-list-title",[t._v("За меня платили")]),t._v(" "),n("history-card",{attrs:{payments:t.payToMe}}),t._v(" "),n("br")],1)},staticRenderFns:[]};var Y=n("VU/8")(Z,z,!1,function(t){n("md95")},null,null).exports;s.a.use(o.a);var W=new o.a({routes:[{path:"/",name:"StartScreen",component:F,children:[{path:"groups/:id",props:!0,name:"GroupScreen",component:X,children:[{path:"addpayment",name:"PaymentForm",component:H,children:[{path:"paidby",name:"PaymentFormUsers",component:j}]}]},{path:"users/:userId",name:"UserScreen",component:Y},{path:"adduser",name:"UsersForm",component:b},{path:"addgroup",name:"GroupsForm",component:f}]}],mode:"hash"}),K=n("NYxO"),tt=n("Dd8w"),et=n.n(tt),nt=n("Zrlr"),st=n.n(nt),rt=function t(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};st()(this,t),this.name=e,this.picture=n,this.balance=s,this.debtors=r},it={state:{users:[]},mutations:{fetchUsers:function(t,e){console.log("Mutation fetchUsers",e),t.users=e},createUser:function(t,e){console.log("Mutation createUser",e),t.users.push(et()({},e))},updateUser:function(t,e){var n=e.id,s=e.balance,r=e.debtors;console.log("Mutation updateUser");var i=t.users.find(function(t){return t.id===n});i.balance=s,i.debtors=r}},actions:{fetchUsers:function(t,e){var n=this,s=t.commit,r=t.rootState;return l()(u.a.mark(function t(){var e,i,a;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.db.collection("users"),t.next=3,e.get();case 3:i=t.sent,console.log("async fetchUsers",i),a=[],i.forEach(function(t){return a.push(et()({id:t.id},t.data()))}),s("fetchUsers",a);case 8:case"end":return t.stop()}},t,n)}))()},createUser:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.name,a=e.picture;return l()(u.a.mark(function t(){var e,o,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new rt(i,a),o=r.db.collection("users").add(et()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createUser",c),s("createUser",et()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()},updateUser:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.id,a=e.balance,o=e.debtors;return l()(u.a.mark(function t(){var e,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateUser",{id:i,balance:a,debtors:o}),e=r.db.collection("users").doc(i).update({balance:a,debtors:o}),t.next=4,e;case 4:c=t.sent,console.log("async updateUser",c),s("updateUser",{id:i,balance:a,debtors:o});case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getUsers:function(t){return t.users},getDebtors:function(t){var e=[],n=t.users;return n.forEach(function(t,s){var r=function(s){console.log(t.debtors[s]),t.debtors[s]<0&&e.push({who:{id:t.id,name:t.name,picture:t.picture},whom:{id:s,name:n.filter(function(t){return t.id===s})[0].name,picture:n.filter(function(t){return t.id===s})[0].picture},sum:t.debtors[s]})};for(var i in t.debtors)r(i)}),e},getNameByUserId:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0].name}},getPictureByUserId:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0].picture}},getUserById:function(t,e){return function(e){return t.users.filter(function(t){return t.id===e})[0]}}}},at=function t(e,n){st()(this,t),this.name=e,this.members=n},ot={state:{groups:[]},mutations:{fetchGroups:function(t,e){console.log("Mutation fetchGroups",e),t.groups=e},createGroup:function(t,e){console.log("Mutation createGroup",e),t.groups.push(et()({},e))},updateGroup:function(t,e){var n=e.id,s=e.members;console.log("Mutation updateGroup"),t.groups.find(function(t){return t.id===n}).members=s},updateGroupMember:function(t,e){var n=e.id,s=e.memberID,r=e.debtors,i=e.balance;console.log("Mutation updateGroupMember");var a=t.groups.find(function(t){return t.id===n}).members.find(function(t){return t.id===s});a.debtors=r,a.balance=i}},actions:{fetchGroups:function(t,e){var n=this,s=t.commit,r=t.rootState;return l()(u.a.mark(function t(){var e,i,a;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.db.collection("groups");case 2:return e=t.sent,t.next=5,e.get();case 5:i=t.sent,console.log("async fetchGroups",i),a=[],i.forEach(function(t){return a.push(et()({id:t.id},t.data()))}),s("fetchGroups",a);case 10:case"end":return t.stop()}},t,n)}))()},createGroup:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.name,a=e.members;return l()(u.a.mark(function t(){var e,o,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new at(i,a),o=r.db.collection("groups").add(et()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createGroup",c.id),s("createGroup",et()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()},updateGroup:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.id,a=e.members;return l()(u.a.mark(function t(){var e,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateGroup",a),e=r.db.collection("groups").doc(i).update({members:a}),t.next=4,e;case 4:o=t.sent,console.log("async updatedGroup",o),s("updateGroup",{id:i,members:a});case 7:case"end":return t.stop()}},t,n)}))()},updateGroupMember:function(t,e){var n=this,s=t.commit,r=e.id,i=e.memberID,a=e.debtors,o=e.balance;return l()(u.a.mark(function t(){var e,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Actions updateGroup",r,i,a,o),t.next=3,fetch("http://localhost:3000/groups/"+r,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:R()({id:r,members:{id:i,debtors:a,balance:o}})});case 3:return e=t.sent,t.next=6,e.json();case 6:c=t.sent,console.log("async updateGroupMember",c),s("updateGroupMember",c);case 9:case"end":return t.stop()}},t,n)}))()}},getters:{getGroups:function(t){return t.groups},getGroupById:function(t,e){return function(e){return console.log("Вызов getGroupById"),t.groups.filter(function(t){return t.id===e})}},getDebtorsByGroupId:function(t,e,n,s){return function(t){console.log("Вызов getDebtorsByGroupId");var n=[],r=e.getGroupById(t)[0].members;return r.forEach(function(t,e){var i=function(e){t.debtors[e]<0&&n.push({who:{id:t.id,name:s.getNameByUserId(t.id),picture:s.getPictureByUserId(t.id)},whom:{id:e,name:s.getNameByUserId(r.filter(function(t){return t.id===e})[0].id),picture:s.getPictureByUserId(r.filter(function(t){return t.id===e})[0].id)},sum:t.balance})};for(var a in t.debtors)i(a)}),n}}}},ct=function t(e,n,s,r,i,a){st()(this,t),this.groupId=e,this.description=n,this.sum=s,this.paidBy=r,this.paidTo=i,this.transactions=a},ut={state:{payments:[],paidBy:""},mutations:{updatePaidBy:function(t,e){t.paidBy=e},fetchPayments:function(t,e){console.log("Mutation fetchPayments",e),t.payments=e},createPayment:function(t,e){console.log("Mutation createPayment",e),t.payments.push(et()({},e))}},actions:{fetchPayments:function(t,e){var n=this,s=t.commit,r=t.rootState;return l()(u.a.mark(function t(){var e,i,a;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.db.collection("payments"),t.next=3,e.get();case 3:i=t.sent,console.log("async fetchPayments",i),a=[],i.forEach(function(t){return a.push(et()({id:t.id},t.data()))}),s("fetchPayments",a);case 8:case"end":return t.stop()}},t,n)}))()},createPayment:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.groupId,a=e.description,o=e.sum,c=e.paidBy,d=e.paidTo,p=e.transactions;return l()(u.a.mark(function t(){var e,l,m;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new ct(i,a,o,c,d,p),l=r.db.collection("payments").add(et()({},e)),t.next=4,l;case 4:m=t.sent,console.log("async createPayment",m),s("createPayment",et()({id:m.id},e));case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getPayments:function(t){return t.payments},getPaymentByGroupId:function(t,e){return function(e){return console.log("Вызов getPaymentByGroupId",e),t.payments.filter(function(t){return t.groupId===e})}},getPaymentsFromByUserId:function(t,e){return function(e){return console.log("Вызов getPaymentsFromByUserId",e),t.payments.filter(function(t){return t.paidBy.userId===e})}},getPaymentsToByUserId:function(t,e){return function(e){return console.log("Вызов getPaymentsToByUserId",e),t.payments.filter(function(t){return t.paidBy.userId!==e&&t.paidTo.filter(function(t){return t.userId===e}).length})}},getRecalculateMembersByGroupId:function(t,e,n,s){return function(t){var n=s.getMembersByGroupId(t);console.log("Вызов getRecalculateMembersByGroupId",t);var r=e.getPaymentByGroupId(t),i=JSON.parse(R()(n));return i.map(function(t){t.balance=0}),i.forEach(function(t){r.forEach(function(e){return e.transactions.forEach(function(e){e.userId===t.id&&(t.balance+=e.sum)})})}),i}}}},dt=function t(e,n){st()(this,t),this.groupId=e,this.userId=n},lt={state:{connections:[]},mutations:{fetchConnections:function(t,e){console.log("Mutation fetchConnections",e),t.connections=e},createConnection:function(t,e){console.log("Mutation createConnection",e),t.connections.push(et()({},e))}},actions:{fetchConnections:function(t,e){var n=this,s=t.commit,r=t.rootState;return l()(u.a.mark(function t(){var e,i,a;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.db.collection("connections");case 2:return e=t.sent,t.next=5,e.get();case 5:i=t.sent,console.log("fetchConnections",i),a=[],i.forEach(function(t){return a.push(et()({id:t.id},t.data()))}),s("fetchConnections",a);case 10:case"end":return t.stop()}},t,n)}))()},createConnection:function(t,e){var n=this,s=t.commit,r=t.rootState,i=e.groupId,a=e.userId;return l()(u.a.mark(function t(){var e,o,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=new dt(i,a),o=r.db.collection("connections").add(et()({},e)),t.next=4,o;case 4:c=t.sent,console.log("async createConnection",c.id),s("createConnection",et()({id:c.id},e));case 7:case"end":return t.stop()}},t,n)}))()}},getters:{getMembersByGroupId:function(t,e,n){return function(e){console.log("Вызов getMembersByGroupId",e);var s=[];return t.connections.filter(function(t){return t.groupId===e}).map(function(t){s.push(n.users.users.find(function(e){return e.id===t.userId}))}),s}}}},pt=n("g9Xd"),mt=n.n(pt);n("bxnb");mt.a.initializeApp({apiKey:"AIzaSyBk6M90VAqEL6L7fsZZW1DN7ndRS9HQ8gw",authDomain:"pie-app-2018.firebaseapp.com",databaseURL:"https://pie-app-2018.firebaseio.com",projectId:"pie-app-2018",storageBucket:"pie-app-2018.appspot.com",messagingSenderId:"724148888563"}),s.a.use(K.a);var ft={db:mt.a.firestore()};ft.db.settings({timestampsInSnapshots:!0});var ht=new K.a.Store({state:ft,modules:{users:it,groups:ot,payments:ut,connections:lt}}),vt=n("EOUi"),bt=n.n(vt);n("Xrl+"),n("fLmE");s.a.use(bt.a),Math.round10||(Math.round10=function(t,e){return function(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+n:n))))}("round",t,e)}),s.a.config.productionTip=!1;e.default=new s.a({el:"#app",router:W,store:ht,components:{App:a},template:"<App/>"})},ORgj:function(t,e){},Ol6Z:function(t,e){},QQJq:function(t,e){},T2jN:function(t,e){},Uqx4:function(t,e){},"Xrl+":function(t,e){},fLmE:function(t,e){},md95:function(t,e){},qYcj:function(t,e){},"y+uo":function(t,e){},zwqg:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.9a990e65ccabd20ae265.js.map